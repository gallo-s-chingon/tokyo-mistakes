{{/* saved as baseof.html in tokyo-mistakes/layouts/_default */}}
<!doctype html>
<html lang="{{ site.Language.Lang }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {{- if .IsHome -}} {{ .Site.Title }} {{- else -}} {{ .Title }} | {{ .Site.Title }} {{- end -}}
    </title>

    <!-- Basic Meta Tags -->
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />
    <meta name="author" content="{{ .Site.Params.author }}" />
    <link rel="canonical" href="{{ .Permalink }}" />

    <!-- Open Graph -->
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
    <meta property="og:url" content="{{ .Permalink }}" />
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}" />
    <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />
    {{ $ogImage := .Params.image | default .Params.post_image | default .Site.Params.defaultImage }}
    {{ with $ogImage }}<meta property="og:image" content="{{ . | absURL }}" />{{ end }}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="{{ .Permalink }}" />
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}" />
    <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />
    {{ with $ogImage }}<meta name="twitter:image" content="{{ . | absURL }}" />{{ end }}

    <!-- JSON-LD -->
    {{ if .IsPage }}
      <script type="application/ld+json">
        {
          "@context":"https://schema.org",
          "@type":"{{ if eq .Type "podcast" }}PodcastEpisode{{ else }}BlogPosting{{ end }}",
          "headline":"{{ .Title }}",
          "description":"{{ with .Description }}{{ . }}{{ else }}{{ .Summary }}{{ end }}",
          "url":"{{ .Permalink }}",
          {{ with $ogImage }}"image":"{{ . | absURL }}",{{ end }}
          "datePublished":"{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
          {{ with .Lastmod }}"dateModified":"{{ .Format "2006-01-02T15:04:05Z07:00" }}",{{ end }}
          "author":{"@type":"Person","name":"{{ .Site.Params.author }}"},
          "publisher":{"@type":"Organization","name":"{{ .Site.Title }}",{{ with .Site.Params.logo }}"logo":{"@type":"ImageObject","url":"{{ . | absURL }}"},{{ end }}"url":"{{ .Site.BaseURL }}"}
          {{ if eq .Type "podcast" }}, "audio":{"@type":"AudioObject",{{ with .Params.spotify }}"contentUrl":"https://open.spotify.com/episode/{{ . }}",{{ end }}"duration":"{{ .Params.duration | default "PT1H" }}"}{{ end }}
        }
      </script>
    {{ else if .IsHome }}
      <script type="application/ld+json">
        {"@context":"https://schema.org","@type":"WebSite","name":"{{ .Site.Title }}","description":"{{ .Site.Params.description }}","url":"{{ .Site.BaseURL }}","potentialAction":{"@type":"SearchAction","target":"{{ .Site.BaseURL }}search/?q={search_term_string}","query-input":"required name=search_term_string"}}
      </script>
    {{ end }}

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" />

    <!-- Styles (Hugo Pipes) -->
    {{ $styles := resources.Get "scss/main.scss" | toCSS (dict "targetPath" "assets/main.css") | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $styles.RelPermalink }}" integrity="{{ $styles.Data.Integrity }}" />

    {{ if .Site.Params.search.enabled }}
      <!-- Include raw search index (Hugo-rendered JS) -->
      <script src="{{ (resources.Get "js/search-index.js").RelPermalink }}" defer></script>
    {{ end }}
  </head>
    <!-- Font Awesome (CDN) -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-2sJ4vTn0vR5F4mM0q3q3kM1x0y3v1+0bY3xKp7gq3N7Xjz8WcW4zFf8YvFv3x0Cgl1W8hI8l2Q0qgq7T4o6H8A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    {{/* Theme data attributes for group + scheme */}}
    <script>
      (function(){
        var html = document.documentElement;
        html.dataset.schemeGroup = "{{ default "neutral" .Site.Params.schemeGroup }}";
        html.dataset.scheme = "{{ default "auto" .Site.Params.scheme }}";
      })();
    </script>

  <body>
      {{ partial "header.html" . }}

  <!-- Search Overlay -->
  {{ if .Site.Params.search.enabled }}
    {{ partial "search/overlay.html" . }}
  {{ end }}

  <!-- Page Content -->
  <main id="main" tabindex="-1">
    {{ block "main" . }}{{ end }}
  </main>

  {{ partial "footer.html" . }}

  <!-- Floating Buttons -->
  {{ partial "floating/buttons.html" . }}

  <!-- Scripts -->
  {{ $hideHeader := resources.Get "js/header-hide-on-scroll.js" | minify }}
  <script>{{ $hideHeader.Content | safeJS }}</script>

  {{ if .Site.Params.search.enabled }}
    {{ $search := resources.Get "js/search-init.js" | minify }}
    <script>{{ $search.Content | safeJS }}</script>
  {{ end }}

  {{ $toc := resources.Get "js/toc-compact-h1.js" | minify }}
  <script>{{ $toc.Content | safeJS }}</script>

  {{ $spotify := resources.Get "js/lazy-spotify.js" | minify }}
  <script>{{ $spotify.Content | safeJS }}</script>

  </body>
</html>
