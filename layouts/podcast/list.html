{{ define "main" }}
<div class="container list-page">

  {{ $raw := .RawContent | default "" }}
  {{ $lines := split (replace $raw "\r\n" "\n") "\n" }}
  {{ $contentLines := len $lines }}

  {{ $firstPageSize := 3 }}
  {{ $pageSize := 9 }}
  {{ if le $contentLines 20 }}{{ $firstPageSize = $pageSize }}{{ end }}

  {{ $all := .Pages.ByDate.Reverse }}
  {{ $isFirst := eq .Paginator.PageNumber 1 }}
  {{ $perPage := cond $isFirst $firstPageSize $pageSize }}
  {{ $offset := mul (sub .Paginator.PageNumber 1) $pageSize }}
  {{ if $isFirst }}{{ $offset = 0 }}{{ end }}
  {{ $paged := (first $perPage (after $offset $all)) }}

  {{ $total := len $all }}
  {{ $start := add $offset 1 }}
  {{ $endCandidate := add $offset $perPage }}
  {{ $end := $endCandidate }}
  {{ if gt $endCandidate $total }}{{ $end = $total }}{{ end }}

  {{ if .Content }}
    <div class="list-intro">
      {{ .Content }}
    </div>
  {{ end }}

  <div class="list-meta" style="text-align:right;margin:8px 0 16px;">
    {{ printf "%dâ€“%d of %d" $start $end $total }}
  </div>

  <div class="cards">
    {{ range $paged }}
      <article class="card">
        <a class="card__media" href="{{ .Permalink }}">
          {{ with .Params.youtube }}
            {{ partial "embeds/youtube-card.html" (dict "ctx" $ "page" . "id" .) }}
          {{ else }}
            {{ with (or .Params.post_image .Params.image) }}
              <img src="{{ . | absURL }}" alt="{{ $.Title }}" loading="lazy" />
            {{ end }}
          {{ end }}
        </a>
        <div class="card__body">
          <h2 class="card__title"><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
          <div class="card__meta">{{ partial "meta/post-meta.html" . }}</div>
          <p class="card__excerpt">{{ .Summary }}</p>
          {{ with .Params.spotify }}
            {{ partial "embeds/spotify-inline.html" (dict "ctx" $ "page" . "id" .) }}
          {{ end }}
        </div>
      </article>
    {{ end }}
  </div>

  {{ template "_internal/pagination.html" . }}
</div>
{{ end }}
