{{/* saved as giscus.html in tokyo-mistakes/layouts/partials */}}
{{ if .Site.Params.comments.giscus }}
<div class="comments-section">
  <h3 class="comments-title">Join the Conversation</h3>
  
  <div class="comments-notice">
    <p><strong>Share your thoughts!</strong> Comments are powered by GitHub Discussions.</p>
  </div>
  
  <div class="giscus"></div>
  
  <script>
    function loadGiscus() {
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', '{{ .Site.Params.comments.giscus.repo }}');
      script.setAttribute('data-repo-id', '{{ .Site.Params.comments.giscus.repoId }}');
      script.setAttribute('data-category', '{{ .Site.Params.comments.giscus.category }}');
      script.setAttribute('data-category-id', '{{ .Site.Params.comments.giscus.categoryId }}');
      script.setAttribute('data-mapping', '{{ .Site.Params.comments.giscus.mapping | default "pathname" }}');
      script.setAttribute('data-strict', '{{ .Site.Params.comments.giscus.strict | default "0" }}');
      script.setAttribute('data-reactions-enabled', '{{ .Site.Params.comments.giscus.reactionsEnabled | default "1" }}');
      script.setAttribute('data-emit-metadata', '{{ .Site.Params.comments.giscus.emitMetadata | default "0" }}');
      script.setAttribute('data-input-position', '{{ .Site.Params.comments.giscus.inputPosition | default "bottom" }}');
      script.setAttribute('data-theme', document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light');
      script.setAttribute('data-lang', '{{ .Site.Params.comments.giscus.lang | default "en" }}');
      script.crossOrigin = 'anonymous';
      script.async = true;
      
      const giscusContainer = document.querySelector('.giscus');
      giscusContainer.appendChild(script);
    }
    
    // Load Giscus when the page is fully loaded
    window.addEventListener('load', loadGiscus);
    
    // Update theme when user switches
    document.addEventListener('themeChanged', function(e) {
      const iframe = document.querySelector('.giscus-frame');
      if (iframe) {
        iframe.contentWindow.postMessage(
          { giscus: { setConfig: { theme: e.detail.theme === 'dark' ? 'dark' : 'light' } } },
          'https://giscus.app'
        );
      }
    });
  </script>
</div>
{{ end }}
