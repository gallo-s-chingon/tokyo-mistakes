{{- /* SEO Meta Tags & Structured Data */ -}}

{{- $description := .Description | default .Summary | default .Site.Params.description -}}
{{- $title := .Title -}}
{{- $image := .Params.featuredImage | default .Site.Params.images -}}

{{- /* Open Graph */ -}}
<meta property="og:title" content="{{ $title }}" />
<meta property="og:description" content="{{ $description | plainify | truncate 200 }}" />
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />

{{- with $image -}}
  {{- if reflect.IsSlice . -}}
    {{- range first 6 . -}}
      <meta property="og:image" content="{{ . | absURL }}" />
    {{- end -}}
  {{- else -}}
    <meta property="og:image" content="{{ . | absURL }}" />
  {{- end -}}
{{- end -}}

{{- if .IsPage -}}
  <meta property="article:published_time" content="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}" />
  <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}" />
  {{- with .Params.author -}}
    <meta property="article:author" content="{{ . }}" />
  {{- end -}}
  {{- range .Params.tags -}}
    <meta property="article:tag" content="{{ . }}" />
  {{- end -}}
{{- end -}}

{{- /* Twitter Cards */ -}}
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ $title }}" />
<meta name="twitter:description" content="{{ $description | plainify | truncate 200 }}" />
{{- with $image -}}
  {{- if reflect.IsSlice . -}}
    <meta name="twitter:image" content="{{ index . 0 | absURL }}" />
  {{- else -}}
    <meta name="twitter:image" content="{{ . | absURL }}" />
  {{- end -}}
{{- end -}}

{{- /* JSON-LD Structured Data */ -}}
{{- if eq .Type "episodes" -}}
  {{- /* Podcast Episode Schema */ -}}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "PodcastEpisode",
    "url": "{{ .Permalink }}",
    "name": "{{ .Title }}",
    "description": "{{ $description | plainify }}",
    "datePublished": "{{ .PublishDate.Format "2006-01-02" }}",
    {{- with .Params.episodeNumber -}}
    "episodeNumber": {{ . }},
    {{- end -}}
    {{- with .Params.season -}}
    "partOfSeason": {
      "@type": "PodcastSeason",
      "seasonNumber": {{ . }}
    },
    {{- end -}}
    {{- with .Params.duration -}}
    "duration": "PT{{ . }}",
    {{- end -}}
    {{- with .Params.audioUrl -}}
    "associatedMedia": {
      "@type": "MediaObject",
      "contentUrl": "{{ . }}",
      "encodingFormat": "audio/mpeg"
    },
    {{- end -}}
    "partOfSeries": {
      "@type": "PodcastSeries",
      "name": "{{ .Site.Params.podcast.name | default .Site.Title }}",
      "url": "{{ .Site.BaseURL }}"
    }
  }
  </script>
{{- else if .IsPage -}}
  {{- /* Article/Blog Post Schema */ -}}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ .Title }}",
    "description": "{{ $description | plainify }}",
    "datePublished": "{{ .PublishDate.Format "2006-01-02" }}",
    "dateModified": "{{ .Lastmod.Format "2006-01-02" }}",
    "author": {
      "@type": "Person",
      "name": "{{ .Params.author | default .Site.Params.author.name }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ .Site.Title }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ .Site.Params.podcast.artwork | absURL }}"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ .Permalink }}"
    }
    {{- with $image -}}
    ,
    "image": {
      "@type": "ImageObject",
      {{- if reflect.IsSlice . -}}
      "url": "{{ index . 0 | absURL }}"
      {{- else -}}
      "url": "{{ . | absURL }}"
      {{- end -}}
    }
    {{- end -}}
  }
  </script>
{{- else -}}
  {{- /* Website Schema */ -}}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}",
    "description": "{{ .Site.Params.description }}",
    "publisher": {
      "@type": "Organization",
      "name": "{{ .Site.Title }}"
    }
  }
  </script>
{{- end -}}

{{- /* Canonical URL */ -}}
<link rel="canonical" href="{{ .Permalink }}" />

{{- /* RSS Feed */ -}}
{{- if eq .Type "episodes" -}}
  <link rel="alternate" type="application/rss+xml" title="{{ .Site.Title }} - Podcast Feed" href="{{ "/episodes/index.xml" | absURL }}" />
{{- end -}}
